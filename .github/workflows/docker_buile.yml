name: Build and Deploy Node.js App  

on:  
  push:  
    branches:  
      - main  # 在推送到 main 分支时触发  

jobs:  
  build-and-deploy:  
    runs-on: ubuntu-latest  

    steps:  
      # Step 1: 检出代码  
      - name: Checkout code  
        uses: actions/checkout@v3  

      # Step 2: 设置 Node.js 环境  
      - name: Setup Node.js  
        uses: actions/setup-node@v3  
        with:  
          node-version: 18  # 指定 Node.js 版本，使用稳定版，例如 18  

      # Step 3: 安装依赖  
      - name: Install dependencies  
        run: npm install  && npm instal pm2 -g

      # Step 4: 创建 Docker 映像  
      - name: Build Docker image  
        env:  
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}  
          DOCKERHUB_PAT: ${{ secrets.DOCKERHUB_PAT }}  
        run: |  
           echo $DOCKERHUB_PAT | docker login -u $DOCKERHUB_USERNAME --password-stdin 
          docker build -t $DOCKERHUB_USERNAME/pplx:latest .  

      # Step 5: 推送 Docker 映像到 Docker Hub  
      - name: Push Docker image  
        env:   
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}  
        run: |  
          docker push $DOCKERHUB_USERNAME/pplx:latest
